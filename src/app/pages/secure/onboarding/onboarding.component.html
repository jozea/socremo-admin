<div *ngIf="isLoadingResults" class="loader_container">
    <div class="spinner">
        <div class="spinner-item"></div>
        <div class="spinner-item"></div>
        <div class="spinner-item"></div>
        <div class="spinner-item"></div>
        <div class="spinner-item"></div>
    </div>
</div>

<br>
  <!-- <h2 mat-dialog-title class="text_accion_stone">Enter customer details</h2> -->
<section class="mat-typography">

    <div  class="row">
        <form [formGroup]="broadcastMessageForm" class="d-flex flex-column w-100 px-5 py-2">
            <mat-card class="col-sm-112">
                <div>
                    <h3 style="font-weight: bold;" class="text_accion"> Account Details</h3>
                    <mat-form-field class="col-md-4 col-sm-6 col-xs-12" appearance="outline">
                        <mat-label>Account Number</mat-label>
                        <input [value]="this.broadcastMessageForm.value.accountNumber" matInput type="text" id="accountNumber" name="accountNumber"
                            formControlName="accountNumber" (input)="getAccountDetails()">
                        <button mat-button *ngIf="this.broadcastMessageForm.value.accountNumber" matSuffix mat-icon-button
                            aria-label="Clear" (click)="this.broadcastMessageForm.value.accountNumber=''">
                            <mat-icon>close</mat-icon>
                        </button>
                        <mat-error *ngIf="broadcastMessageForm.get('accountNumber').hasError('minlength')">
                            Account number must be 10 characters
                          </mat-error>
                        </mat-form-field>
                    
        
                    <mat-form-field class="col-md-4 col-sm-6 col-xs-12" appearance="outline">
                        <mat-label>Account First Name</mat-label>
                        <input readonly [(ngModel)]="accFirstName" matInput type="text"
                            formControlName="accountFirstName" >
                        <button mat-button *ngIf="this.broadcastMessageForm.value.accountFirstName" matSuffix mat-icon-button
                            aria-label="Clear" (click)="this.broadcastMessageForm.value.accountFirstName=''">
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-form-field>
                
                    <mat-form-field class="col-md-4 col-sm-6 col-xs-12" appearance="outline">
                        <mat-label>Account Last Name</mat-label>
                        <input readonly [(ngModel)]="accLastName" matInput type="text"
                            formControlName="accountLastName">
                        <button mat-button *ngIf="this.broadcastMessageForm.value.accountLastName" matSuffix mat-icon-button
                            aria-label="Clear" (click)="this.broadcastMessageForm.value.accountLastName=''">
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-form-field>

                    <mat-form-field class="col-md-3 col-sm-6 col-xs-12" appearance="outline">
                        <mat-label>Email Address</mat-label>
                        <input [value]="this.broadcastMessageForm.value.accountEmail" matInput type="text"
                            formControlName="accountEmail">
                        <button mat-button *ngIf="this.broadcastMessageForm.value.accountEmail" matSuffix mat-icon-button
                            aria-label="Clear" (click)="this.broadcastMessageForm.value.accountEmail=''">
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-form-field>

                    <mat-form-field class="col-md-3 col-sm-6 col-xs-12" appearance="outline">
                        <mat-label>Account Mobile Number</mat-label>
                        <input [value]="this.broadcastMessageForm.value.accountMobileNumber" matInput type="text"
                            formControlName="accountMobileNumber">
                        <button mat-button *ngIf="this.broadcastMessageForm.value.accountMobileNumber" matSuffix mat-icon-button
                            aria-label="Clear" (click)="this.broadcastMessageForm.value.accountMobileNumber=''">
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-form-field>
        
                    <mat-form-field class="col-md-6 col-sm-6 col-xs-12" appearance="outline">
                        <mat-label>Company Address</mat-label>
                        <input [value]="this.broadcastMessageForm.value.accountAddress" matInput type="text"
                            formControlName="accountAddress">
                        <button mat-button *ngIf="this.broadcastMessageForm.value.accountAddress" matSuffix mat-icon-button
                            aria-label="Clear" (click)="this.broadcastMessageForm.value.accountAddress=''">
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-form-field>

                    
                    <h3 class="text_accion mt-5" style="font-weight: bold;">Representative Information:</h3>
                    <div formArrayName="representativesInfo"
                        *ngFor="let item of broadcastMessageForm.get('representativesInfo')['controls']; let i = index;"> 
                        <span style="font-weight: bold;">Representative {{i+1}}</span>
                        <div [formGroupName]="i">
                            <mat-form-field class="col-md-3 col-sm-6 col-xs-12" appearance="outline">
                                <mat-label>First Name</mat-label>
                                <input [value]="this.broadcastMessageForm.value.firstName" matInput type="text"
                                    formControlName="firstName">
                                <button mat-button *ngIf="this.broadcastMessageForm.value.firstName" matSuffix mat-icon-button
                                    aria-label="Clear" (click)="this.broadcastMessageForm.value.firstName=''">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
            
                            <mat-form-field class="col-md-3 col-sm-6 col-xs-12" appearance="outline">
                                <mat-label>Last Name </mat-label>
                                <input [value]="this.broadcastMessageForm.value.lastName" matInput type="text"
                                    formControlName="lastName">
                                <button mat-button *ngIf="this.broadcastMessageForm.value.lastName" matSuffix mat-icon-button
                                    aria-label="Clear" (click)="this.broadcastMessageForm.value.lastName=''">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
            
                            <mat-form-field class="col-md-3 col-sm-6 col-xs-12" appearance="outline">
                                <mat-label>Email</mat-label>
                                <input [value]="this.broadcastMessageForm.value.email" matInput type="text" formControlName="email">
                                <button mat-button *ngIf="this.broadcastMessageForm.value.email" matSuffix mat-icon-button
                                    aria-label="Clear" (click)="this.broadcastMessageForm.value.email=''">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
            
                            <mat-form-field class="col-md-3 col-sm-6 col-xs-12" appearance="outline">
                                <mat-label>Mobile Number</mat-label>
                                <input [value]="this.broadcastMessageForm.value.mobileNumber" matInput type="text"
                                    formControlName="mobileNumber">
                                <button mat-button *ngIf="this.broadcastMessageForm.value.mobileNumber" matSuffix mat-icon-button
                                    aria-label="Clear" (click)="this.broadcastMessageForm.value.mobileNumber=''">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
                        </div>

                    </div>
                    <button style="color: white; background-color: rgb(93, 235, 93);" mat-raised-button type="button" (click)="addItem()">Add Rep</button>&nbsp;
                    <button style="color: white; background-color: rgb(228, 86, 86);" mat-raised-button *ngIf="add" type="button" (click)="removevalue()">Remove Rep</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <button class="float-right" style="color: white; background-color: rgb(102, 102, 235);" mat-raised-button (click)="submit()">Initiate</button>
                </div>
            </mat-card>        
        </form>
    </div>
</section>



<div class="table_display mx-3 mt-5">
    <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <button  (click)="toggleApprovalTab()" class="nav-link active" id="nav-awaiting-approval-tab" data-bs-toggle="tab"
                data-bs-target="#nav-awaiting-approval" type="button" role="tab" aria-controls="nav-awaiting-approval"
                aria-selected="true">Awaiting Approval</button>
            <button  (click)="toggleWaitingTab()" class="nav-link" id="nav-approved-payments-tab" data-bs-toggle="tab"
                data-bs-target="#nav-approved-payments" type="button" role="tab" aria-controls="nav-approved-payments"
                aria-selected="false">Approved Representatives</button>
        </div>
    </nav>

    <div *ngIf="waiting" >
        <div style="margin-bottom: 5%;" class=" mat-elevation-z8">
            <div id="branches_table" class="table-container p-0">
                <table mat-table [dataSource]="unApprovedRep" class="mat-elevation-z8">
    
                    <ng-container matColumnDef="position">
                        <th mat-header-cell *matHeaderCellDef> S/N </th>
                        <td mat-cell *matCellDef="let element; let i = index;"> {{i+1}} </td>
                    </ng-container>
    
                    <ng-container matColumnDef="companyName">
                        <th mat-header-cell *matHeaderCellDef> Company Account Name </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.accountFirstName}} {{element.accountLastName}}
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="companyAccNumber">
                        <th mat-header-cell *matHeaderCellDef> Company Account Number </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.accountNumber}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="createDate">
                        <th mat-header-cell *matHeaderCellDef> CreatedAt </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.createdAt}}
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="updateDate">
                        <th mat-header-cell *matHeaderCellDef> UpdatedAt </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.updatedAt}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef> Action </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="element.initiatorId == userId" class="cursor_pointer" (click)="openDialog(element)"><mat-icon >edit</mat-icon></span>&nbsp;
                            <span *ngIf="element.initiatorId != userId" style="font-weight: bold; color: green;" class="cursor_pointer" (click)="openDialog2(element)"><mat-icon >done</mat-icon></span>
                        </td>
                    </ng-container>
    
                    <!-- <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef> Action </th>
                        <td mat-cell *matCellDef="let element">
                            <button (click)="openDialog(element)" mat-raised-button
                                style="color: white; background-color: rgb(58, 66, 55);">Amend</button>
                                <button (click)="openDialog(element)" mat-raised-button
                                style="color: white; background-color: rgb(58, 66, 55);">Approve</button>
                        </td>
                    </ng-container> -->
    
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    
                    <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell" colspan="4">
                            No data</td>
                    </tr>
                </table>
            </div>
            <div class="d-flex justify-content-end align-items-center">
                <mat-paginator 
            [pageSizeOptions]="[10, 25, 50, awaitingMaxall]" 
            [length]="awaitingMaxall" 
            (page)="onPageFired($event)"
            showFirstLastButtons></mat-paginator>
            </div>
        </div>
    </div>
    

    <div *ngIf="!waiting" >
        <div style="margin-bottom: 5%;" class=" mat-elevation-z8">
            <div id="branches_table" class="table-container p-0">
                <table mat-table [dataSource]="approvedReps" class="mat-elevation-z8">
    
                    <ng-container matColumnDef="position">
                        <th mat-header-cell *matHeaderCellDef> S/N </th>
                        <td mat-cell *matCellDef="let element; let i = index;"> {{i+1}} </td>
                    </ng-container>
    
                    <ng-container matColumnDef="companyName">
                        <th mat-header-cell *matHeaderCellDef> Company Account Name </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.accountFirstName}} {{element.accountLastName}}
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="companyAccNumber">
                        <th mat-header-cell *matHeaderCellDef> Company Account Number </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.accountNumber}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="createDate">
                        <th mat-header-cell *matHeaderCellDef> CreatedAt </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.createdAt}}
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="updateDate">
                        <th mat-header-cell *matHeaderCellDef> UpdatedAt </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.updatedAt}}
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="action">
                        <th  mat-header-cell *matHeaderCellDef> Action </th>
                        <td mat-cell *matCellDef="let element">
                            <span class="cursor_pointer" (click)="openDialog3(element)" mat-raised-button style="font-weight: bold; color: rgb(9, 167, 35); ">View Approved</span> 
                        </td>
                    </ng-container>
    
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    
                    <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell" colspan="4">
                            No data</td>
                    </tr>
                </table>
            </div>
            <div class="d-flex justify-content-end align-items-center">
                <mat-paginator 
            [pageSizeOptions]="[10, 25, 50, approvedMaxall]" 
            [length]="approvedMaxall" 
            (page)="onPageFired($event)"
            showFirstLastButtons></mat-paginator>
            </div>
        </div>
    </div>
    
</div>



<!--
    <div class="row ml-5 mt-5">
                        
        <div class="row">
            <span style="color: rgb(93, 235, 93); font-weight: bold; font-size: 18px;"><mat-icon>add_box</mat-icon></span>&nbsp;
            <span style="margin-top: 4px; color: rgb(93, 235, 93); font-weight: bold; font-size: 18px;">Add Rep</span>
        </div>                    
        <div class="row ml-5">
            <span style="color: rgb(228, 86, 86); font-weight: bold; font-size: 18px;"><mat-icon >remove_circle_outline</mat-icon></span>&nbsp;
            <span style="margin-top: 4px;color: rgb(228, 86, 86); font-weight: bold; font-size: 18px;">Remove Rep</span>
        </div>
    </div>
-->